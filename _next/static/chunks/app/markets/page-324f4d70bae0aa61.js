(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[757],{2523:function(e,t,r){Promise.resolve().then(r.bind(r,7431))},7431:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return MarketsPage}});var a=r(7437),s=r(2265),l=r(4033),n=r(1396),i=r.n(n),o=r(5800),components_MarketCard=e=>{let{market:t}=e,r=t.listing_name||t.marketname||t.MarketName||"Farmers Market";t.listing_desc||t.brief_desc;let s=t.location_address||[t.street||t.Address,t.city||t.City,t.state||t.State].filter(Boolean).join(", "),l="number"==typeof t.distance?"".concat(t.distance.toFixed(1)," mi"):"string"==typeof t.distance?"".concat(parseFloat(t.distance).toFixed(1)," mi"):"",n=t.location_x&&t.location_y,c=n?"https://maps.google.com/?q=".concat(t.location_y,",").concat(t.location_x):"",d=n?"https://www.google.com/maps/embed/v1/place?key=".concat("AIzaSyBOiQ6uKkW6VPbqQE3FA9eU9ShppPKQHjo","&q=").concat(t.location_y,",").concat(t.location_x,"&zoom=14"):"",u=t.listing_id||t.id||"fallback-id";return(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow duration-300 overflow-hidden h-full flex flex-col",children:[n?(0,a.jsxs)("div",{className:"relative h-48",children:[(0,a.jsx)("iframe",{src:d,width:"100%",height:"100%",style:{border:0},allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",title:"Map location for ".concat(r)}),l&&(0,a.jsx)("div",{className:"absolute top-3 right-3 bg-green-500 text-white px-2 py-1 rounded-full text-xs font-medium z-10",children:l}),(0,a.jsx)("a",{href:c,target:"_blank",rel:"noopener noreferrer",className:"absolute inset-0 z-0","aria-label":"Open Google Maps for ".concat(r)})]}):(0,a.jsxs)("div",{className:"h-48 bg-gray-100 flex items-center justify-center",children:[(0,a.jsx)("div",{className:"text-gray-400",children:"No location data available"}),l&&(0,a.jsx)("div",{className:"absolute top-3 right-3 bg-green-500 text-white px-2 py-1 rounded-full text-xs font-medium",children:l})]}),(0,a.jsxs)("div",{className:"p-4 flex-grow flex flex-col",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-1 text-gray-800 line-clamp-1",children:r}),s&&(0,a.jsxs)("div",{className:"flex items-start mb-2",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400 mr-1 mt-0.5 flex-shrink-0",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})}),(0,a.jsx)("p",{className:"text-gray-500 text-sm line-clamp-1",children:s})]}),(0,a.jsx)("div",{className:"mt-auto pt-3 flex items-center justify-between border-t border-gray-100",children:(0,a.jsxs)(i(),{href:(0,o.K3)("/market-details?id=".concat(u)),className:"text-green-600 hover:text-green-800 font-medium text-sm inline-flex items-center",children:["View Details",(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 ml-1",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z",clipRule:"evenodd"})})]})})]})]})},c=r(9682);function MarketsPage(){let e=(0,l.useSearchParams)(),[t,r]=(0,s.useState)([]),[n,i]=(0,s.useState)(!0),[o,d]=(0,s.useState)(null),{setMarkets:u}=(0,c.useMarketData)(),h=(null==e?void 0:e.get("zip"))||"",m=(null==e?void 0:e.get("radius"))?parseInt((null==e?void 0:e.get("radius"))||"20"):20;return(0,s.useEffect)(()=>{(async function(){if(!h){d("ZIP code is required"),i(!1);return}try{i(!0);let e="wT29LlT8K9",t="".concat("https://www.usdalocalfoodportal.com/api","/farmersmarket/?apikey=").concat(e,"&zip=").concat(h,"&radius=").concat(m);console.log("Making direct API call to USDA API (API key hidden):",t.replace(e,"***API_KEY***"));let a=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json","User-Agent":"FarmersMarketDirectory/1.0"},credentials:"omit"});if(!a.ok)throw Error("API responded with status ".concat(a.status));let s=await a.json();if(Array.isArray(s)){let e=s.filter(e=>{let t=e.media_website;if(!t)return!1;try{return new URL(t),!0}catch(e){return!1}});r(e),u(e)}else if(s&&s.results&&Array.isArray(s.results)){let e=s.results.filter(e=>{let t=e.media_website;if(!t)return!1;try{return new URL(t),!0}catch(e){return!1}});r(e),u(e)}else if(s&&s.data&&Array.isArray(s.data)){let e=s.data.filter(e=>{let t=e.media_website;if(!t)return!1;try{return new URL(t),!0}catch(e){return!1}});r(e),u(e)}else console.error("Unexpected API response format:",s),r([]);d(null)}catch(e){console.error("Error fetching markets:",e),d("Failed to fetch farmers markets. Please try again."),r([])}finally{i(!1)}})()},[h,m,u]),(0,a.jsxs)("div",{className:"markets-page container mx-auto px-4 py-8",children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold mb-6",children:["Farmers Markets Near ",h]}),n?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mb-4"}),(0,a.jsx)("p",{children:"Loading markets..."})]}):o?(0,a.jsxs)("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6",children:[(0,a.jsx)("p",{children:o}),(0,a.jsx)("a",{href:"/",children:(0,a.jsx)("button",{className:"mt-4 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded",children:"Try New Search"})})]}):0===t.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsxs)("p",{className:"mb-4",children:["No markets found near ZIP code ",h,"."]}),(0,a.jsx)("a",{href:"/",children:(0,a.jsx)("button",{className:"bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded",children:"Try New Search"})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{className:"mb-6",children:["Found ",t.length," markets within ",m," miles of ",h]}),(0,a.jsx)("a",{href:"/",children:(0,a.jsx)("button",{className:"mb-6 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded",children:"New Search"})}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map((e,t)=>(0,a.jsx)(components_MarketCard,{market:e},t))})]})]})}},9682:function(e,t,r){"use strict";r.r(t),r.d(t,{MarketDataProvider:function(){return MarketDataProvider},useMarketData:function(){return useMarketData}});var a=r(7437),s=r(2265);let l=(0,s.createContext)(void 0);function MarketDataProvider(e){let{children:t}=e,[r,n]=(0,s.useState)([]);return(0,s.useEffect)(()=>{try{let e=localStorage.getItem("savedMarkets");e&&n(JSON.parse(e))}catch(e){console.error("Error loading saved markets:",e)}},[]),(0,s.useEffect)(()=>{if(r.length>0)try{localStorage.setItem("savedMarkets",JSON.stringify(r))}catch(e){console.error("Error saving markets:",e)}},[r]),(0,a.jsx)(l.Provider,{value:{markets:r,setMarkets:n,getMarketById:e=>{let t=r.find(t=>t.id===e||t.listing_id===e);return t||null},clearMarkets:()=>{n([]),localStorage.removeItem("savedMarkets")}},children:t})}function useMarketData(){let e=(0,s.useContext)(l);if(void 0===e)throw Error("useMarketData must be used within a MarketDataProvider");return e}},5800:function(e,t,r){"use strict";function getAssetPath(e){console.log("getAssetPath js input:",e);let t="/find-my-farmers-market",r=e.startsWith("/")?e:"/".concat(e);console.log("Cleaned path:",r);let a=r.startsWith(t),s=r.includes("".concat(t,"/")),l=r===t;if(console.log("Path checks:",{startsWithBase:a,hasBaseInMiddle:s,equalsBase:l,cleanPath:r,basePath:t}),a||s||l)return console.log("Path already contains basePath, returning as-is:",r),r;let n="".concat(t).concat(r);return console.log("getAssetPath js output:",n),n}r.d(t,{K3:function(){return getAssetPath}})},4033:function(e,t,r){e.exports=r(94)}},function(e){e.O(0,[176,971,472,744],function(){return e(e.s=2523)}),_N_E=e.O()}]);